<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simplified Hexanaut.io</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #f0f0f0;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const hexSize = 20;
        const gridWidth = Math.ceil(canvas.width / (hexSize * 3)) + 2;
        const gridHeight = Math.ceil(canvas.height / (hexSize * Math.sqrt(3))) + 2;

        let playerX = Math.floor(gridWidth / 2);
        let playerY = Math.floor(gridHeight / 2);
        let playerDirection = 0; // 0: right, 1: down-right, 2: down-left, 3: left, 4: up-left, 5: up-right

        const grid = Array(gridHeight).fill().map(() => Array(gridWidth).fill(0));
        const trail = [];

        function drawHex(x, y, filled = false) {
            const centerX = x * hexSize * 3 + hexSize;
            const centerY = y * hexSize * Math.sqrt(3) + hexSize;

            ctx.beginPath();
            for (let i = 0; i < 6; i++) {
                const angle = Math.PI / 3 * i;
                const pointX = centerX + hexSize * Math.cos(angle);
                const pointY = centerY + hexSize * Math.sin(angle);
                if (i === 0) {
                    ctx.moveTo(pointX, pointY);
                } else {
                    ctx.lineTo(pointX, pointY);
                }
            }
            ctx.closePath();

            if (filled) {
                ctx.fill();
            } else {
                ctx.stroke();
            }
        }

        function drawGrid() {
            ctx.strokeStyle = '#ccc';
            for (let y = 0; y < gridHeight; y++) {
                for (let x = 0; x < gridWidth; x++) {
                    drawHex(x, y);
                }
            }
        }

        function drawPlayer() {
            ctx.fillStyle = '#ff0000';
            drawHex(playerX, playerY, true);
        }

        function drawTrail() {
            ctx.fillStyle = '#ffcccc';
            for (const [x, y] of trail) {
                drawHex(x, y, true);
            }
        }

        function drawCapturedArea() {
            ctx.fillStyle = '#ff9999';
            for (let y = 0; y < gridHeight; y++) {
                for (let x = 0; x < gridWidth; x++) {
                    if (grid[y][x] === 1) {
                        drawHex(x, y, true);
                    }
                }
            }
        }

        function movePlayer() {
            const directions = [
                [1, 0], [1, 1], [0, 1],
                [-1, 0], [-1, -1], [0, -1]
            ];
            const [dx, dy] = directions[playerDirection];
            playerX += dx;
            playerY += dy;

            if (playerX < 0) playerX = gridWidth - 1;
            if (playerX >= gridWidth) playerX = 0;
            if (playerY < 0) playerY = gridHeight - 1;
            if (playerY >= gridHeight) playerY = 0;

            if (grid[playerY][playerX] === 0) {
                trail.push([playerX, playerY]);
            } else {
                captureArea();
            }
        }

        function captureArea() {
            const floodFill = (x, y) => {
                if (x < 0 || x >= gridWidth || y < 0 || y >= gridHeight || grid[y][x] === 2) return;
                grid[y][x] = 2;
                floodFill(x + 1, y);
                floodFill(x - 1, y);
                floodFill(x, y + 1);
                floodFill(x, y - 1);
            };

            for (const [x, y] of trail) {
                grid[y][x] = 1;
            }

            for (let y = 0; y < gridHeight; y++) {
                floodFill(0, y);
                floodFill(gridWidth - 1, y);
            }
            for (let x = 0; x < gridWidth; x++) {
                floodFill(x, 0);
                floodFill(x, gridHeight - 1);
            }

            for (let y = 0; y < gridHeight; y++) {
                for (let x = 0; x < gridWidth; x++) {
                    if (grid[y][x] === 0) {
                        grid[y][x] = 1;
                    } else if (grid[y][x] === 2) {
                        grid[y][x] = 0;
                    }
                }
            }

            trail.length = 0;
        }

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawGrid();
            drawCapturedArea();
            drawTrail();
            drawPlayer();
            movePlayer();
            requestAnimationFrame(gameLoop);
        }

        document.addEventListener('keydown', (event) => {
            switch (event.key) {
                case 'ArrowRight':
                    playerDirection = 0;
                    break;
                case 'ArrowDown':
                    playerDirection = 2;
                    break;
                case 'ArrowLeft':
                    playerDirection = 3;
                    break;
                case 'ArrowUp':
                    playerDirection = 5;
                    break;
            }
        });

        gameLoop();
    </script>
</body>
</html>